<!DOCTYPE html>
<html>
<head>
  <title>ES Mod Injector</title>
  <style>
    body {
      background: #ffffff;
      color: #000000;
      font-family: system-ui, sans-serif;
      text-align: center;
      padding-top: 60px;
    }

    h1 { font-size: 36px; }

    select {
      padding: 10px;
      font-size: 16px;
      margin: 15px;
    }

    a.button {
      display: inline-block;
      padding: 14px 28px;
      margin: 10px;
      border: 2px solid #000;
      color: #000;
      text-decoration: none;
      font-size: 18px;
      cursor: pointer;
    }

    a.button:hover {
      background: #000;
      color: #fff;
    }

    .footer { margin-top: 40px; }
  </style>
</head>
<body>

<h1>ES Mod Injector</h1>
<p>Select a menu, then drag the inject button to your bookmarks bar.</p>

<select id="menu" onchange="update()">
  <option value="https://raw.githubusercontent.com/EEEE842/esmodinjector/main/test.sb3">Nova Menu</option>
  <option value="https://raw.githubusercontent.com/EEEE842/esmodinjector/main/dev.sb3">Dev Menu</option>
  <option value="https://raw.githubusercontent.com/EEEE842/esmodinjector/main/rd.sb3">Robot Destructor Menu</option>
</select>

<br>

<a id="inject" class="button">Inject Menu</a>

<div class="footer">
  <a id="download" class="button" download>Download SB3</a>
</div>

<script>
function update() {
  const sb3 = document.getElementById("menu").value;

  const bookmarklet =
    "javascript:(function(){"+
    "function findVMWindow(){"+
      // Case 1: TurboWarp exposes vm directly
      "if(window.vm){ return window; }"+
      // Case 2: iframe-based VM
      "let frames=document.getElementsByTagName('iframe');"+
      "for(let i=0;i<frames.length;i++){"+
        "try{"+
          "if(frames[i].contentWindow && frames[i].contentWindow.vm){"+
            "return frames[i].contentWindow;"+
          "}"+
        "}catch(e){}"+
      "}"+
      "return null;"+
    "}"+
    "function inject(win){"+
      "win.ES_SELECTED_SB3='"+ sb3 +"';"+
      "var s=win.document.createElement('script');"+
      "s.src='https://raw.githubusercontent.com/EEEE842/esmodinjector/main/injector.js';"+
      "win.document.body.appendChild(s);"+
    "}"+
    "var w=findVMWindow();"+
    "if(!w){ alert('Scratch/TurboWarp VM not found'); return; }"+
    "inject(w);"+
    "})();";

  document.getElementById("inject").href = bookmarklet;
  document.getElementById("download").href = sb3;
}

update();
</script>

</body>
</html>
